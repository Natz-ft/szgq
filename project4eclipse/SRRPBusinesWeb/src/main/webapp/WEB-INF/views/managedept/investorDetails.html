<%@page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %> <%@
taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html>
<!-- 防止IE提示允许阻止的内容-->
<!-- saved from url=(0014)about:internet -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>投资机构详情</title>
<script src="../static/script/autoload.js" type="text/javascript"></script>
<script src="../static/script/autoLoadStyle.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css"
	href="../static/style/page/details.css">
<style>
.detailsTxt p img {
	max-width: 20%;
	cursor: pointer;
}

.detailsTxt p {
	max-width: 100%;
	width: 46%;
}
</style>

</head>
<body>
	<!--头部logo以及登录注册开始-->
	<div class="boxWrap">
		<p class="boxTitle">
			<span>${investor.name}</span>
		</p>
		<div class="boxContent" >
			<div class="detailsCon">
				<div class="detail-title-name">
					<span>基本信息</span>
				</div>
				<div class="detailsTxt clearfix">
					<p>
						证件号码类型：<span>${investor.certtypeDicname}</span>
					</p>
					<p>
						证件号码：<span>${investor.certno}</span>
					</p>
					<p>
						组织形式：<span>${investor.organizationalFormDicname}</span>
					</p>
					<p>
						成立日期：<span>${investor.registeTime}</span>
					</p>
					<p>
						所属地区：<span>${investor.areaName}</span>
					</p>
					<p>
						注册资本(万)：<span><fmt:formatNumber
								value="${investor.registeredCapital}" pattern="####.##" /> ${investor.regCurrencyDicname}</span>
					</p>
					<p>
						实缴资本(万)：<span><fmt:formatNumber
								value=" ${investor.paidCapital}" pattern="####.##" />
							${investor.pcCurrencyDicname}</span>
					</p>
					<p>
						机构类型：<span>${investor.orgTypeDicname}</span>
					</p>
					<p>
						资本类型：<span>${investor.capitalTypeDicname}</span>
					</p>
					<p>
						操作时间：<span>${investor.OPERDATEStr}</span>
					</p>
					<p>
						状态：<span>${investor.stopFlagDicname}</span>
					</p>
					<p>
						法定代表人/执行事务合伙人：<span>${investor.legalRepresentative}</span>
					</p>
					<p>
						法定代表电话/执行事务合伙人电话：<span>${investor.legalRepresentativeCall}</span>
					</p>
					<p>
						审核状态：<span>${investor.auditStatusDicname}</span>
					</p>
					<p style="width: 100%;">
						注册地址：<span>${investor.registeredAddress}</span>
					</p>
					<p style="width: 100%;">
						办公地址：<span>${investor.officeAddress}</span>
					</p>
					<!-- <p class="aloneRow">
						<label>营业执照：</label> <span id="layer-photos"> <img
							alt="营业执照" src="${investor.licensePath}"
							layer-src="${investor.licensePath}" />
						</span>
					</p> -->
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>日常联系人</span>
				</div>
				<div class="detailsTxt clearfix">
					<p>
						姓名：<span>${investor.relName}</span>
					</p>
					<p>
						职务：<span>${investor.post}</span>
					</p>
					<p>
						联系电话：<span>${investor.relPhone}</span>
					</p>
					<p>
						电子邮箱：<span>${investor.email}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>运营资质</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 100%">
						是否在中国证券基金业协会履行基金管理人登记手续：
						<c:choose>
							<c:when test='${not empty investor.operationQualification2}'>
								<span>是</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;基金管理人登记编号：<span>${investor.operationQualification2}</span>
							</c:when>
							<c:otherwise>
								<span>否</span>
							</c:otherwise>
						</c:choose>
					</p>
					<p style="width: 100%">
						机构是否有过不良诚信记录 ：<span>${investor.operationQualification3Dicname}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>团队成员</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 100%">
						团队总人数：<span>${investor.teamCount}</span>
					</p>
					<p style="width: 100%">
						从事股权投资且具备3年以上相关工作经验的人员数量（获得基金从业资格证）：<span>${investor.seniorManagement}</span>
					</p>
					<p style="width: 100%">
						团队成员是否有过不良诚信记录：<span>${investor.creditUnhealthyDicname}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>管理机制</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 100%">
						是否具备严格合理的投资决策程序、风险控制机制以及健全的财务管理制度：<span>${investor.mechanismDicname}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>综合实力</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 80%">
						<span>${investor.corepersonnel}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>核心团队</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 80%">
						<span>${investor.coreteam}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>投资策略</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 100%;">
						管理资本量(亿)：<span>
							${investor.capital} 
							</span>
					</p>
					<p style="width: 100%;">
						主要投资阶段：<span>${investor.financeStageDicname}</span>
					</p>
					<p style="width: 100%;">
						主要投资领域：<span>${investor.financeTradeDicname}</span>
					</p>
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>影像信息：</span>
				</div>
				<div class="detailsTxt clearfix">
					<p style="width: 100%">
						 营业执照：<span><a  name = "preview" download="${investor.fileName}" style="cursor:pointer;" href="${investor.licensePath}">${investor.fileName}	 </a></span>
					</p>
					<p style="width: 100%">
						注册申请表：<span> <a  name = "preview" download="${investor.registerAutographName}" style="cursor:pointer;" href="${investor.registerAutographPath}">
								      ${investor.registerAutographName}</a></span>
					</p>
					<p style="width: 100%">
						   授权书：<span><a  name = "preview" download="${investor.creditAuthorizationName}" style="cursor:pointer;" href="${investor.creditAuthorizationPath}">${investor.creditAuthorizationName}</a></span>
					</p>
					<p style="width: 100%">
						  LOGO：<span><a  name = "preview" download="${investor.logoName}" style="cursor:pointer;" href="${investor.logoPath}">${investor.logoName}</a></span>
					</p>
					
				</div>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>管理业绩</span>
				</div>
					<c:choose>
					<c:when test='${manageAchievementList!="[]"}'>
						<div id="manageAchievementDiv">
							<div style="margin-left: 11%;width: 90%;">
									<table align="center" id="manageAchievementGrid"
										lay-filter="manageAchievementGrid"></table>
							</div>
						</div>
						</c:when>
						<c:otherwise>

							<div class="detailsTxt clearfix">
								<p style="width: 100%">
									管理业绩：<span>无</span>
								</p>
								<p style="width: 100%">
									未填写原因：<span>${investor.manageAchievementDesc}</span>
								</p>

							</div>
						</c:otherwise>
					</c:choose>
			</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>投资业绩</span>
				</div>
				<!-- ==============================================================  -->
						<c:choose>
						<c:when test='${investorAchievements!="[]"}'>
					<div  id="investorAchievementDiv">
						<div style="margin-left: 11%;width: 90%;">
									<table align="center" id="investorAchievementGrid"
										lay-filter="investorAchievementGrid"></table>
						</div>
						</div>					
								</c:when>
								<c:otherwise>
									<div class="detailsTxt clearfix">
								<p style="width: 100%">
									投资业绩：<span>无</span>
								</p>
								<p style="width: 100%">
									未填写原因：<span>${investor.achievementDesc}</span>
								</p>

							</div>
								</c:otherwise>
							</c:choose>
				</div>
			<div class="detailsCon clearfix">
				<div class="detail-title-name">
					<span>审核记录</span>
				</div>
					<div style="margin-left: 11%;width: 90%;">
						<table align="center" id="investorGrid" lay-filter="test"></table>
					</div>
			</div>
			<div class="buttonWrap">
				<button class="layui-btn viewCreditReportBtn">&nbsp;&nbsp;征信报告</button>
				<c:if test='${investor.auditStatus=="1"  }'>
					<c:if test='${investor.userType=="04" || investor.userType=="06" }'>
						<button class="layui-btn auditBtn" style="display: inline"
							id="auditDiv">&nbsp;&nbsp;审&nbsp;&nbsp;&nbsp;核&nbsp;&nbsp;</button>
					</c:if>
				</c:if>
				<c:if test='${investor.auditStatus=="4"  }'>
					<c:if test='${investor.userType=="04" || investor.userType=="06" }'>
						<button class="layui-btn auditBtn" style="display: inline"
							id="auditDiv">&nbsp;&nbsp;审&nbsp;&nbsp;&nbsp;核&nbsp;&nbsp;</button>
					</c:if>
				</c:if>
				<c:if test='${investor.auditStatus=="2"}'>
					<c:if test='${investor.userType=="05"}'>
						<button class="layui-btn auditBtn" style="display: inline"
							id="auditDiv">&nbsp;&nbsp;激&nbsp;&nbsp;&nbsp;活&nbsp;&nbsp;</button>
					</c:if>
				</c:if>
				<button class="layui-btn closeBtn">&nbsp;&nbsp;关&nbsp;&nbsp;&nbsp;闭&nbsp;&nbsp;</button>
			</div>
		</div>
	</div>

	<script src="../static/script/autoLoadScript.js" type="text/javascript"></script>
	<script>
		var has_showModalDialog = !!window.showModalDialog;//定义一个全局变量判定是否有原生showModalDialog方法  
		if (!has_showModalDialog && !!(window.opener)) {
			window.onbeforeunload = function() {
				window.opener.hasOpenWindow = false; //弹窗关闭时告诉opener：它子窗口已经关闭  
			}
		}
		//定义window.showModalDialog如果它不存在  
		if (window.showModalDialog == undefined) {
			window.showModalDialog = function(url, mixedVar, features) {
				if (mixedVar)
					var mixedVar = mixedVar;
				//因window.showmodaldialog 与 window.open 参数不一样，所以封装的时候用正则去格式化一下参数  
				if (features)
					var features = features.replace(/(dialog)|(px)/ig, "")
							.replace(/;/g, ',').replace(/\:/g, "=");

				var left = (window.screen.width - parseInt(features
						.match(/width[\s]*=[\s]*([\d]+)/i)[1])) / 2;
				var top = (window.screen.height - parseInt(features
						.match(/height[\s]*=[\s]*([\d]+)/i)[1])) / 2;
				window.myNewWindow = window.open(url, "_blank", features);
			}
		}
		$(function() {
			var path = '${investor.licensePath}';
			var status = '${investor.auditStatus}';
			var divV = document.getElementById("auditDiv");
// 			if (status == 1 || status == 4) {
// 				//展示审核按钮
// 				if (divV.style.display == "none") {
// 					divV.style.display = 'inline';
// 				}
// 			} else {
// 				//隐藏审核按钮
// 				if (divV.style.display == "inline") {
// 					divV.style.display = 'none';
// 				}
// 			}
			//数据表格
			layui.use('table', function() {
				var table = layui.table;
				// 赋值数据实际使用为后台获取数据
				var gridData = ${investorAuditRecords}
				;
				table.render({
					id : 'investorGrid',
					elem : '#investorGrid' //指定原始表格元素选择器（推荐id选择器）
					,page: true
	                , limits: [5, 10, 20, 50]
	                , limit: 5
// 	                , width : 605,
					,data : gridData,
					cols : [ [ //标题栏
					{
						field : 'auditorName',
						title : '审核人',
						align : 'center',
						width : '22%'
					}, {
						field : 'auditTimeStr',
						title : '审核时间',
						align : 'center',
						width : '15%'
					}, {
						field : 'auditResultDicname',
						title : '审核结果',
						align : 'center',
						width : '15%'
					}, {
						field : 'auditContent',
						title : '审核意见',
						align : 'center',
						width : '43.2%'
					} ] ]
				});
				layer.photos({
					photos : '#layer-photos',
					anim : 0
				//0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
				});
			});
			layui.use('table', function() {
				var table = layui.table;
				// 赋值数据实际使用为后台获取数据
				var manageData = ${manageAchievementList};
				//管理业绩列表
				table.render({
					id : 'manageAchievementGrid',
					elem : '#manageAchievementGrid' //指定原始表格元素选择器（推荐id选择器）
					,page: true
	                , limits: [5, 10, 20, 50]
	                , limit: 5,
					data : manageData,
					cols : [ [ //标题栏
					{
						field : 'fundName',
						title : '管理基金名称',
						align : 'center',
						width :'12%'
					}, {
						field : 'registDateString',
						title : '注册时间',
						align : 'center',
						width : '9%'
					}, {
                        field: 'trusteeship',
                        title: '托管机构',
                        align: 'center',
                        width: '10%'
                    }, {
						field : 'registAddressStr',
						title : '注册地',
						align : 'center',
						width : '10%'
					}, {
						field : 'manageCapital',
						title : '管理资金规模(万)',
						align : 'center',
						width : '15%'
					}, {
						field : 'iccFilingNo',
						title : '基金编号(中基协)',
						align : 'center',
						width : '16%'
					}, {
						field : 'foundTypeDicname',
						title : '基金类型',
						align : 'center',
						width :'12%',
					}, {
						field : 'financeTradeDicname',
						title : '投资行业定位',
						align : 'center',
						width : '12%'
					}, {
						field : 'financeStageDicname',
						title : '投资阶段定位',
						align : 'center',
						width : '14%'
					}, {
						field : 'investmentProjects',
						title : '投资项目数量',
						align : 'center',
						width : '12%'
					}, {
						field : 'cumulativeInvestment',
						title : '累计投资金额（万）',
						align : 'center',
						width : '16%'
					}, {
						field : 'implementExitProject',
						title : '实现退出项目数量',
						align : 'center',
						width :'15%'
					} ] ]
				});
				//投资业绩列表
				var investorData = ${investorAchievements};
				table.render({
					id : 'investorAchievementGrid',
					elem : '#investorAchievementGrid', //指定原始表格元素选择器（推荐id选择器）
					page: true
	                , limits: [5, 10, 20, 50]
	                , limit: 5,
					data : investorData,
					cols : [ [ //标题栏
					{
						field : 'investmentFunds',
						title : '投资基金名称',
						align : 'center',
						width : '12%'
					}, {
						field : 'investedEnterprise',
						title : '已投企业名称',
						align : 'center',
						width : '12%'
					}, {
						field : 'investedEnterpriseIndustryStr',
						title : '已投企业行业',
						align : 'center',
						width : '12%'
					}, {
						field : 'investedEnterpriseAreaStr',
						title : '已投企业所属区域',
						align : 'center',
						width : '16%'
					}, {
						field : 'ecCurrencyStr',
						title : '已投企业注册资本(万)',
						align : 'center',
						width : '17%'
					}, {
						field : 'investmentTimeStr',
						title : '投资时间',
						align : 'center',
						width : '12%'
					}, {
						field : 'iaCurrencyStr',
						title : '投资金额(万)',
						align : 'center',
						width : '13%'
					}, {
						field : 'shareRatio',
						title : '股权比例(%)',
						align : 'center',
						width : '12%'
					}, {
						field : 'roundOfInvestmentStr',
						title : '投资轮次',
						align : 'center',
						width : '12%'
					}, {
						field : 'investmentStageStr',
						title : '投资阶段',
						align : 'center',
						width : '12%'
					},{
                        field: 'signOutStr',
                        title: '是否退出',
                        align: 'center',
                        width: '12%'
                    }, {
						field : 'exitTimeStr',
						title : '退出时间',
						align : 'center',
						width : '12%'
					}, {
						field : 'rateOfReturnStr',
						title : '回报率(%)',
						align : 'center',
						width : '12%'
					} ] ]
				});

				layer.photos({
					photos : '#layer-photos',
					anim : 0
				//0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
				});
			});
			//审核按钮点击事件
			$(".auditBtn")
					.on(
							"click",
							function() {
								parent.layer
										.open({
											title : '审核机构',
											content : "/SRRPBusinesWeb/investorManage/auditInvestor?investorId="
													+ "${investor.investorId}",
											area : [ '100%', '100%' ],
											offset : [ '0%', '0%' ],
											type : 2,
										});
							});
			//查看信用报告
			$(".viewCreditReportBtn")
					.on(
							"click",
							function() {
								var code = "${investor.certno}";
								var name = "${investor.name}";
								var codetype= "${investor.certtype}";
					            codetype=encodeURIComponent(encrypt(codetype));
								code= encodeURIComponent(encrypt(code));
								var url="/SRRPBusinesWeb/creditscore/queryReport?certtype=" + codetype + "&certno=" + code + "&name='" + name + "'";
								url = encodeURI(encodeURI(url));
								window.showModalDialog(url, "1", "dialogWidth:"
										+ window.screen.width
										+ "px;dialogHeight:"
										+ window.screen.height + "px;");
							});
			//增加"关闭"按钮事件
			$(function() {
				//点击进行关闭操作
				$(".closeBtn").on("click", function() {
					var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
					parent.layer.close(index); //关闭layer(关闭当前窗口)
				});
			});
		});
	</script>
</body>
</html>