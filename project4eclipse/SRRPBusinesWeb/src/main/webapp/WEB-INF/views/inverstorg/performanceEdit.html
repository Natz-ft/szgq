<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%> 
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>投资需求</title>
<script src="../static/script/autoload.js" type="text/javascript"></script>
<script src="../static/script/autoLoadStyle.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css"
	href="../static/style/page/form.css">
<link rel="stylesheet" type="text/css"
	href="../static/style/page/todo.css">
<style>
.layui-form #layer-photos img {
	max-width: 200px;
}

.layui-form .industryCheckbox li {
	float: left;
	width: 33%;
}

.layui-form-label {
	padding: 6px 0px;
	width: 135px;
}

.input-insert-data {
	height: 22px;
	border: 1px solid #8DBDDC;
	border-radius: 3px;
}

.layui-input1 {
	width: 420px;
	height: 28px;
	border: 1px solid #8DBDDC;
	border-radius: 3px;
	margin-top: 4px;
}

.layui-form-select .layui-input {
	height: 22px;
}

.boxWrap .formWrap .form-title {
	height: 100%;
	padding-top: 10px;
}

.boxWrap .formWrap .form-excle {
	height: 100%;
	padding-top: 10px;
	margin-left: 36px;
	margin-top: 4px;
	margin-bottom: 10px;
}

.layui-input-block1 {
	padding-top: 10px;
	padding-right: 20px;
}

.layui-input-block {
	margin-left: 140px;
}

.layui-form-item1 {
	height: 30px;
	margin-bottom: 5px;
}

.layui-form-item {
	margin-bottom: 3px;
}

.achievementButoon {
	margin-left: 70%;
}

.exportMoudle {
	    margin-left: 87%;
    margin-top: -7%;
    width: 100%;
}

.layui-btn-sm {
    height: 30px;
    line-height: 30px;
    padding: 0 10px;
    font-size: 12px;
}
</style>
</head>
<body>
	<div class="boxWrap">
		<div class="boxContent">
			<div class="formWrap">
			<input type="hidden" id="manageResult"  >
			<input type="hidden" id="achiveResult"  >
			<input type="hidden" id="updateFlag"  value="00">
			<input type="hidden" id="manageUpdateFlag"  value="00">
			<input type="hidden" id="achieveUpdateFlag"  value="00">
         <form id="form2" name ="form2" class="layui-form" method="post" > <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
				   <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
				   <input type="hidden" id="inputId1"  value="00">
					<input type="hidden" id="fileupHidden" name="manageAchievementPath"  value='' autocomplete="off" class="layui-input"> <input type="hidden" id="manageAchievementName" name="manageAchievementName" value=""> 
<!-- 					<a id="downloadFile" style="color: #FF6838; display: none" download="投资机构业绩表模板" href="../static/script/投资机构业绩表模板.xlsx">下aaaa载模板</a> -->
					<a id="downloadFile" style="color: #FF6838;display:none " download="投资机构业绩表模板.xlsx" href="../static/files/sqxy/moudleInvestor.xlsx">下载模板 </a>  

					<input type="hidden" name="investorId" value='${investor.investorId}'>
					<div class="layui-form-item">
						<div class="form-title"  style="width: 100%;">
							<span>业绩信息 </span><span style="color:red;margin-left: 23%;">注：业绩信息填写完成后，请点击下一步保存信息。</span>
							
						</div>
						<div class="exportMoudle" id="exportMoudle" >
								<div class="layui-btn-group">
									<button class="layui-btn layui-btn-sm downloadFileButton"
										lay-filter="downloadFileButton">
										<i class="layui-icon">&#xe630;</i>下载模板
									</button>
									 <button type="button" class="layui-btn layui-btn-sm uploadButton" id="investAchievementFile">
                              			 <i class="layui-icon">&#xe67c;</i>Excel导入
                                	</button>
								</div>
							</div>
					</div>
					<div style="margin-left: 14px;">

						<div class="layui-form-item">
							<label class="layui-form-label" style="width: 152px;"><span class="star">*</span>是否有管理基金情况：</label>
							<div class="layui-input-block">
								<input class="manageAchievementFalg" type="radio" id ="manageAchievementFalg" 
									lay-verify="required" lay-filter="manageAchievementRadio"
									name="manageAchievementFalg" value='1' title='是'
								<c:if test='${investor.manageAchievementFalg eq "1"}'>checked</c:if>
								> <input calss="manageAchievementFalg" type="radio"
									lay-verify="required" lay-filter="manageAchievementRadio"
									name="manageAchievementFalg" value='2' title='否'
								<c:if test='${investor.manageAchievementFalg eq "2"}'>checked</c:if>
								>
							</div>
						</div>
						<div style="display: none" id="manageAchievementDestDiv">
							<div class="layui-form-item heightAuto">
								<label class="layui-form-label" style="width: 152px;">说明原因：</label>
								<div class="layui-input-block" style="padding-top: 12px">
									<textarea name="manageAchievementDesc" class="layui-textarea"
										id="manageAchievementDesc"
										placeholder="若没有在苏州注册基金，请说明原因，我方会进行核实" maxlength="1000"
										style="border: 1px solid #8DBDDC; width: 90%; border-radius: 3px;">${investor.manageAchievementDesc}</textarea>
								</div>
							</div>
						</div>
						<div id="manageAchievementTableDiv" style="display: none">
							<div class="layui-form-item heightAuto">
								<div
									style="width: auto; padding: 0px; margin-left: -6%; margin-top: 1%;">
									<div>
										<div style="margin: 0 auto;">
											<div>
												<table align="center" id="investorManageAchievementGrid" name="investorManageAchievementGrid"
													lay-filter="investorManageAchievementFilter"></table>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="layui-input-block buttonWrap"
								style="margin-left: 0px;">
								<div class="layui-btn-group">
									<button class="layui-btn layui-btn-xs manageAchievement"
										lay-filter="investorManageAchievementForm">
										<i class="layui-icon">&#xe654;</i>增加
									</button>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label" style="width: 152px;"><span class="star">*</span>是否有投资项目情况：</label>
							<div class="layui-input-block">
								<input class="achievementFalg" type="radio" id="achievementFalg"
									lay-verify="required" lay-filter="achievementRadio" 
									name="achievementFalg" value='1' title='是'
								<c:if test='${investor.achievementFalg eq "1"}'>checked</c:if>> 
								<input calss="achievementFalg" type="radio" lay-verify="required" lay-filter="achievementRadio" name="achievementFalg" value='2' title='否'
								<c:if test='${investor.achievementFalg eq "2"}'>checked</c:if> >
							</div>
						</div>
						<div style="display: none" id="achievementDestDiv">
							<div class="layui-form-item heightAuto">
								<label class="layui-form-label" style="width: 152px;">说明原因：</label>
								<div class="layui-input-block" style="padding-top: 12px">
									<textarea name="achievementDesc" class="layui-textarea"
										id="achievementDescId" placeholder="若基金没有投在苏州的项目，请说明原因，我方会进行核实"
										maxlength="1000"
										style="border: 1px solid #8DBDDC; width: 90%; border-radius: 3px;">${investor.achievementDesc}</textarea>
								</div>
							</div>
						</div>	
						<div id="achievementTableDiv" style="display: none">
							<div class="layui-form-item heightAuto">
								<div
									style="width: auto; padding: 0px; margin-left: -6%; margin-top: 1%;">
									<div>
										<div style="margin: 0 auto;">
											<div>
												<table align="center" id="investorAchievementGrid"
													lay-filter="investorAchievementFilter"></table>
											</div>
										</div>
									</div>
								</div>
								<div class="layui-input-block buttonWrap"
									style="margin-left: 0px;">
									<div class="layui-btn-group">
										<button class="layui-btn layui-btn-xs  insertDate"
											lay-filter="investorManageAchievementForm">
											<i class="layui-icon">&#xe654;</i>增加
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="form-title"><span>填写说明</span></div>
					<div style="margin-left: 14px;">
					   <div style="margin-left: -2%;margin-top: 1%;"><p style="font-family: Microsoft YaHei; color: #333; font-size: 14px; display: inline;margin-left: 45px;">
					     1.凡是有涉及在苏州注册的基金和投在苏州的项目，需填写相应业绩信息；若任一情况不存在，请填写说明原因，我方会进行核实。</p></div>
					  <div  style="margin-left: -2%;margin-top: 1%;"><p style="font-family: Microsoft YaHei; color: #333; font-size: 14px; display: inline;margin-left: 45px;">
					     2.对于信息填写不全或存在虚假信息填报的机构，一经发现，在平台业务开展和政策优惠等方面会有所限制。</p></div>
					</div>
					<div class="layui-form-item">
                       <div class="layui-input-block buttonWrap" style="margin-left:8px;">
                          <button class="layui-btn upId" id="upId"  >&nbsp;&nbsp;上&nbsp;一&nbsp;步&nbsp;&nbsp;</button>
                          <button class="layui-btn submitBtn" id="submitId" lay-submit lay-filter="investor">&nbsp;&nbsp;下&nbsp;一&nbsp;步&nbsp;&nbsp;</button>
                      </div>
                    </div>
				</form>	
			</div>
		</div>
	</div>	
<script src="../static/script/autoLoadScript.js" type="text/javascript"></script>
<script type="text/html" id="investButtonBar">
<a lay-event="investDeleteButton" class="layui-btn layui-btn-mini">删除</a>
</script>
<script type="text/html" id="manageButtonBar"><a lay-event="manageBeleteButton" class="layui-btn layui-btn-mini">删除</a></script>
		<script>
		var manageAchievementTablelns;
		var achievementTablelns;
    $(function () {
    	var auditStatus = '${investor.auditStatus}';
    	var  InvestAchievementStr;
        // 上传文件控件
        var upload = layui.upload;
        var table = layui.table;
        var achievementFalg;
        var manageAchievementFalg;
        
        var manageflag = "${investor.manageAchievementFalg}";
        var exportV = document.getElementById("exportMoudle");
        var DedivV = document.getElementById("manageAchievementDestDiv");
        var TadivV = document.getElementById("manageAchievementTableDiv");
        if (manageflag == "1") {
            if (TadivV.style.display == "none") {
                TadivV.style.display = 'inline'; //展示审核意见
            }
            if (DedivV.style.display == "inline") {
                DedivV.style.display = 'none'; //展示审核意见
            }
        }
        if (manageflag == "2") {
            if (DedivV.style.display == "none") {
                DedivV.style.display = 'inline'; //展示审核意见
            }
            if (TadivV.style.display == "inline") {
                TadivV.style.display = 'none'; //展示审核意见
            }
        }
        var achievementFlag = "${investor.achievementFalg}";
        var aDedivV = document.getElementById("achievementDestDiv");
        var aTadivV = document.getElementById("achievementTableDiv");
        exportMoudle
        if (achievementFlag == "1") {
            if (aTadivV.style.display == "none") {
                aTadivV.style.display = 'inline'; //展示审核意见
            }
            if (aDedivV.style.display == "inline") {
                aDedivV.style.display = 'none'; //展示审核意见
            }
        }
        if (achievementFlag == "2") {
            if (aDedivV.style.display == "none") {
                aDedivV.style.display = 'inline'; //展示审核意见
            }
            if (aTadivV.style.display == "inline") {
                aTadivV.style.display = 'none'; //展示审核意见
            }
        }
        layui.use('form',function () {
                    var form = layui.form;
                    form.on('radio(manageAchievementRadio)', function (data) {
                    	var manid = $("input[name='manageAchievementFalg']:checked").val();
                         if (manid == 1) { //审核通过
                         	 if (exportV.style.display == "none") {
                              	exportV.style.display = 'inline'; //展示审核意见
                              }
                             if (TadivV.style.display == "none") {
                                 TadivV.style.display = 'inline'; //展示审核意见
                             }
                             if (DedivV.style.display == "inline") {
                                 DedivV.style.display = 'none'; //展示审核意见
                             }
                         } else if (manid == 2) { //审核不通过

                             if (DedivV.style.display == "none") {
                                 DedivV.style.display = 'inline'; //展示审核意见
                             }
                             if (TadivV.style.display == "inline") {
                                 TadivV.style.display = 'none'; //展示审核意见
                             }
                             if (exportV.style.display == "inline") {
                             	exportV.style.display = 'none'; //展示审核意见
                             }
                         }         
                    });

                    $(".manageAchievementSubmitDesc").on("click", function () {
                    	if(auditStatus!='4' && auditStatus!='1' && auditStatus!="2"){ 
                                var desc = $("#manageAchievementDesc").val();
                                if(desc===''){
                               	 parent.layer.msg("请输入说明原因", {icon: 5});
                           	      $("#manageAchievementDesc").focus();
                  					  return false;
                                  }
                                parent.layer.confirm(
                                        '确认提交？', { btn: [ '确定','取消']
                                        },
                                        function (index) {
                                        	$.ajax({
                                                    type: "post",
                                                    url: "/SRRPBusinesWeb/investor/updateaChievement",
                                                    data: {
                                                        "desc": desc,
                                                        "type": "1"
                                                    },
                                                    success: function (data) {
                                                                    parent.layer.close(index);
                                                    }
                                                });
                                        },
                                        function (index) {
                                        })
                    	}else{
              	          parent.layer.alert("机构信息正在审核，不能进行提交。");
                        }         
                                return false;
                    });
                    form.on('radio(achievementRadio)',function (data) {
                    	var id = $( "input[name='achievementFalg']:checked").val();
                         if (id == 1) { //审核通过
                             if (aTadivV.style.display == "none") {
                                 aTadivV.style.display = 'inline'; //展示审核意见
                             }
                             if (aDedivV.style.display == "inline") {
                                 aDedivV.style.display = 'none'; //展示审核意见
                             }
                         } else if (id == 2) { //审核不通过

                             if (aDedivV.style.display == "none") {
                                 aDedivV.style.display = 'inline'; //展示审核意见
                             }
                             if (aTadivV.style.display == "inline") {
                                 aTadivV.style.display = 'none'; //展示审核意见
                             }
                             
                          }        
                    });
                    $(".achievementSubmitDesc").on("click",function () {
                    	if(auditStatus!='4' && auditStatus!='1' && auditStatus!="2"){
                                var desc = $("#achievementDescId").val();
                                if(desc===''){
                                	 parent.layer.msg("请输入说明原因", {icon: 5});
                            	      $("#achievementDescId").focus();
                   					  return false;
                                }
                                parent.layer.confirm( '确认提交？', { btn: [ '确定','取消']},
                                        function (index) {
                                        	$.ajax({
                                                    type: "post",
                                                    url: "/SRRPBusinesWeb/investor/updateaChievement",
                                                    data: {
                                                        "desc": desc,
                                                        "type": "2"
                                                    },
                                                    success: function (data) {
                                                                    parent.layer.close(index);
                                                    }
                                                });
                                        },
                                        function (index) {
                                        	
                                        })
                    	   }else{
                	          parent.layer.alert("机构信息正在审核，不能进行提交。");
                            }       
                                return false;
                 });
                    $(".manageAchievement").on("click", function () {
                    	if(auditStatus!='4' && auditStatus!='1' && auditStatus!="2"){ 
                    		layer.open({
                                type: 2,
                                title: '新增管理业绩',
                                shadeClose: true,
                                maxmin: true,
                                scrollbar: false,
                                shade: 0,
                                area: [
                                    '880px',
                                    '520px'
                                ],
                                content: '/SRRPBusinesWeb/investor/addManageAchievement' //iframe的url
                             });
                          }else{
                    	          parent.layer.alert("机构信息正在审核，不能进行添加。");
                          }  
                    	 return false;
                   });
                   
                    $(".downloadFileButton").on("click",
                            function () {
                                document
                                    .getElementById(
                                        "downloadFile")
                                    .click();
                                return false;
                            });
                    $(".upId").on("click",function () {
                    	    window.parent.update_page("111");
            	        	var index = parent.layer.getFrameIndex(window.name);
            	        	parent.layer.close(index);
                    });
                    //增加投资业绩弹出框
                    $(".insertDate").on("click",function () {
                    		 if(auditStatus!='4' && auditStatus!='1' && auditStatus!="2"){
                                    layer .open({
                                            type: 2,
                                            title: '新增投资业绩',
                                            shadeClose: true,
                                            maxmin: true,
                                            scrollbar: false,
                                            shade: 0,
                                            area: [
                                                   '760px',
                                                   '460px'
                                            ],
                                            content: '/SRRPBusinesWeb/investor/addInvestAchievement' //iframe的url
                                        });
                    		 }else{
                             	 parent.layer.alert("机构信息正在审核，不能进行添加。");
                             }
                        return false;
                   });
                })
               if(auditStatus!='4' && auditStatus!='1' && auditStatus!="2"){
                var creditAuthUpload = upload.render({
                       elem: '#investAchievementFile',
//                        exts: 'xls|XLS|xlsx',
                       data: {
                           "fileType": 'zxsqs'
                       },
                       url: '/SRRPBusinesWeb/investor/readExcelModle' //上传接口
                       ,
                       accept: 'file' //普通文件
                       ,
                       done: function (data) {
                    	   if (data.code == "00000") {
                    		   parent.layer.msg(data.msg, {icon: 6,time: 3000}, function(){
//                     			   location.href="/SRRPBusinesWeb/investor/editInvestorType?operType=performanceInformation";
                                var manaD=data.list1;
                                var achiveD=data.list2;
                                reloadTableList(achiveD);
                                reloadManageTableList(manaD);
                    		   })  	
                           } else {
                        	   layer.alert(data.msg, {icon: 2,btnAlign: 'c',offset: 't',shade: 0});
//                         	   parent.layer.msg(data.msg, {icon: 5,time: 6000});   
                          		return false;
                           }
                      }
                  });
         }
        //投资业绩
        var investorAchievementData = ${investorAchievement};
        achievementTablelns= table.render({
            id: 'investorAchievementGrid',
            elem: '#investorAchievementGrid', //指定原始表格元素选择器（推荐id选择器）
            width: 900
            , page: true
            , limits: [5, 10, 20, 50]
            , limit: 5,
            data: investorAchievementData,
            cols: [
                [ //标题栏
                    {
                        field: 'investmentFunds',
                        title: '投资基金名称',
                        align: 'center',
                        width: 160
                    }, {
                        field: 'investedEnterprise',
                        title: '已投企业名称',
                        align: 'center',
                        width: 160
                    }, {
                        field: 'investedEnterpriseIndustryStr',
                        title: '已投企业行业',
                        align: 'center',
                        width: 110
                    }, {
                        field: 'investedEnterpriseAreaStr',
                        title: '已投企业所属区域',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'ecCurrencyStr',
                        title: '已投企业注册资本(万)',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'investmentTimeStr',
                        title: '投资时间',
                        align: 'center',
                        width: 90
                    }, {
                        field: 'iaCurrencyStr',
                        title: '投资金额(万)',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'shareRatio',
                        title: '股权比例(%)',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'roundOfInvestmentStr',
                        title: '投资轮次',
                        align: 'center',
                        width: 80
                    }, {
                        field: 'investmentStageStr',
                        title: '投资阶段',
                        align: 'center',
                        width: 80
                    }, {
                        field: 'signOutStr',
                        title: '是否退出',
                        align: 'center',
                        width: 90
                    }, {
                        field: 'exitTimeStr',
                        title: '退出时间',
                        align: 'center',
                        width: 90
                    }, {
                        field: 'rateOfReturnStr',
                        title: '回报率(%)',
                        align: 'center',
                        width: 80
                    }, {
                        field: '',
                        title: '操作',
                        align: 'center',
                        width: 100,
                        toolbar: '#investButtonBar'
                    }
                ]
            ]
        });

        //管理业绩
        var investorManageAchievementData = ${investorManageAchievement};
        manageAchievementTablelns=table.render({
            id: 'investorManageAchievementGrid',
            elem: '#investorManageAchievementGrid', //指定原始表格元素选择器（推荐id选择器）
            width: 900
            , page: true
            , limits: [5, 10, 20, 50]
            , limit: 5,
            data: investorManageAchievementData,
            cols: [
                [ //标题栏
                    {
                        field: 'fundName',
                        title: '管理基金名称',
                        align: 'center',
                        width: 110
                    }, {
                        field: 'registDateString',
                        title: '注册时间',
                        align: 'center',
                        width: 90,
                    }, {
                        field: 'registAddressStr',
                        title: '注册地',
                        align: 'center',
                        width: 110
                    }, {
                        field: 'trusteeship',
                        title: '托管机构',
                        align: 'center',
                        width: 110
                    }, {
                        field: 'manageCapital',
                        title: '管理资金规模(万)',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'iccFilingNo',
                        title: '基金编号(中基协)',
                        align: 'center',
                        width: 122
                    }, {
                        field: 'foundTypeDicname',
                        title: '基金类型',
                        align: 'center',
                        width: 100,
                    }, {
                        field: 'financeTradeDicname',
                        title: '投资行业定位',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'financeStageDicname',
                        title: '投资阶段定位',
                        align: 'center',
                        width: 100
                    }, {
                        field: 'investmentProjects',
                        title: '投资项目数量',
                        align: 'center',
                        width: 80
                    }, {
                        field: 'ciCurrencyStr',
                        title: '累计投资金额（万）',
                        align: 'center',
                        width: 80
                    }, {
                        field: 'implementExitProject',
                        title: '实现退出项目数量',
                        align: 'center',
                        width: 80
                    }, {
                        field: '',
                        title: '操作',
                        align: 'center',
                        width: 80,
                        toolbar: '#manageButtonBar'
                    }
                ]
            ]
        });
        table.on('tool(investorManageAchievementFilter)',
                function (obj) {
                    var data = obj.data;
                    var ii=$(obj.tr.selector).attr('data-index');
                    var managedata=manageAchievementTablelns.config.data;
                    if (obj.event === 'manageBeleteButton') {
                    	if(auditStatus!=4 && auditStatus!=1 && auditStatus!=2){
                    		layer.confirm('确定删除记录？', function(index){
                    			document.getElementById("manageUpdateFlag").value="01";
                    			document.getElementById("updateFlag").value="01";
//                                 managedata.splice(ii, 1);
                                for (var a = 0; a  < managedata.length; a++) {
                    				var achiveManageObj=managedata[a];
                    				delete achiveManageObj['LAY_TABLE_INDEX'];
                    		        if (JSON.stringify(achiveManageObj)== JSON.stringify(data)){
                    		        	managedata.splice(a, 1);
                    		        }
                    		    }
                                manageAchievementTablelns= table.reload('investorManageAchievementGrid',{  
              		              data : managedata
              		          }) 
                               
                                layer.close(index);
                              });
                    	}else{
                    		parent.layer.alert("机构信息正在审核，无法进行删除。");
                    	}
                    }
                });
        table .on('tool(investorAchievementFilter)',
                function (obj) {
                    var data1 = obj.data;
                    var ii=$(obj.tr.selector).attr('data-index');
                    var achieData =  achievementTablelns.config.data;
                    if (obj.event === 'investDeleteButton') {
                    	if(auditStatus!=4 && auditStatus!=1 && auditStatus!=2){
                    		layer.confirm('确定删除记录', function(index){
                    			document.getElementById("achieveUpdateFlag").value="01";
                    			document.getElementById("updateFlag").value="01";
//                     			achieData.splice(ii, 1);
                    			for (var a = 0; a  < achieData.length; a++) {
                    				var achiveObj=achieData[a];
                    				delete achiveObj['LAY_TABLE_INDEX'];
                    		        if (JSON.stringify(achiveObj)== JSON.stringify(data1)){
                    		        	achieData.splice(a, 1);
                    		        }
                    		    }
                    			 achievementTablelns=table.reload('investorAchievementGrid',{  
               		              data : achieData
               		          }) 
                                layer.close(index);
                              });
                    	}else{
                    		parent.layer.alert("机构信息正在审核，无法进行删除。");
                    	}
                    }
          });
        $("#submitId").on("click",function () {
        	var  madFlag = document.getElementById("manageAchievementDesc").value;
            var   adFlag   =   document.getElementById("achievementDescId").value;
            var manaData =  manageAchievementTablelns.config.data; 
            var achieData =  achievementTablelns.config.data;
//             var achieData =  table.cache["investorAchievementGrid"]; 
          //这几行代码是去掉删除数据后留下的地址空间
            var updateFlag=document.getElementById("updateFlag").value;
            var manageUpdateFlag=document.getElementById("manageUpdateFlag").value;
            var achieveUpdateFlag=document.getElementById("achieveUpdateFlag").value;
            var achievementFalg = $( "input[name='achievementFalg']:checked").val();
            var manageAchievementFalg = $("input[name='manageAchievementFalg']:checked").val();
              if(manageAchievementFalg==null || manageAchievementFalg=='' || manageAchievementFalg=='undefined'){//判断是否录入业绩信息
            	  parent.layer.alert("请选择是否有管理基金情况");
            	  return false;
              }  if( achievementFalg==null || achievementFalg=='' || achievementFalg=='undefined'){
            	  parent.layer.alert("请选择是否有投资项目情况");
            	  return false;
        	  } if(manageAchievementFalg=='1'){
        		  if(JSON.stringify(manaData)=='[]'){
        			  parent.layer.alert("请录入管理基金情情况");
        			  return false;
        		  }
        	  } if(manageAchievementFalg=='2'){
        		  if(madFlag==null || madFlag=='' || madFlag=="undefined"||$(madFlag)==''){
        	               parent.layer.alert("请填写管理基金情况无的说明原因");
        	               return false;
        		  }
        	  } if(achievementFalg=='1'){
        		  if(JSON.stringify(achieData)=='[]'){
        			  parent.layer.alert("请录入投资项目情况");
        			  return false;
        		  }
        	  }
              if(achievementFalg=='2'){
        		  if(adFlag==null || adFlag=='' || adFlag=="undefined"||$.trim(adFlag)==''){
        	               parent.layer.alert("请填写投资项目情况无的说明原因");
        	               return false;
        		  }
        		  
        	  }
              if((manageAchievementFalg=='1') && (achievementFalg=='1')){//如果管理项目数与投资项目数都选择录入的情况下
            	  var flag =false;
            	  var mycars = new Array(); 
            	  //循环管理业绩列表获得到管理项目的基金名称、投资项目数、退出项目数
            	  manaData.forEach(function(val,index){//获得管理项目表中基金的投资项目数
            		  var investmentProjects=0
            		  var exitinvestmentProject=0
		        	  var data={};
		        	  data=val;
		        	  investmentProjects=data["investmentProjects"];//管理业绩表中存的投资项目数
			    	  exitinvestmentProject=data["implementExitProject"];//管理业绩表中的退出项目数
		        	  var name=data["fundName"];//管理业绩的基金名称
		        	  mycars[index]=name;
			    	  var countAchieve=0;//投资业绩中的总项目数
			    	  var countExitAchieve=0;//投资业绩的总的退出项目数
			    	  achieData.forEach(function(val,index){
			    		     var achiedata={};
				        	 achiedata=val;
				        	 var investmentFunds=achiedata["investmentFunds"];
				        	 var signOut=achiedata["signOut"];
				        	 if(investmentFunds==name){
				        		 countAchieve+=1;
				        		 if(signOut=='0'){//如果用户选择退出了则退出个数加1
				        			 countExitAchieve+=1;
					        	 }
				        	 }
					    	});
			    	  if(investmentProjects < countAchieve){
			    		  flag =true;
			    		  parent.layer.alert("投资项目情况中的"+name+"（基金名称）投资的项目记录条数与管理基金情况中该基金的投资项目数量不匹配，请核对。");
			    	  }else{
			    		  if(exitinvestmentProject < countExitAchieve){
			    			  flag =true;
			    			  parent.layer.alert("投资项目情况中的"+name+"（基金名称）退出的项目记录条数与管理基金情况中该基金的退出项目数量不匹配，请核对。");
			    		  }
			    	  }
			    	});
            	  var nary=mycars.sort();
            	   for(var i=0;i<mycars.length;i++){
            	   if (nary[i]==nary[i+1]){
		    		parent.layer.alert("管理基金情况中的管理基金名称"+nary[i]+"已经存在请输入其他管理名称。");
            	    return false;
            	   }
            	   }

            	  if(flag){
            		  return false;
            	  }
              }
              if(auditStatus!="4" && auditStatus!="1" && auditStatus!="2"){
            	  var desc = { madFlag:madFlag,adFlag:adFlag,achievementFalg:achievementFalg,manageAchievementFalg:manageAchievementFalg,updateFlag:updateFlag,manageUpdateFlag:manageUpdateFlag,achieveUpdateFlag:achieveUpdateFlag};
        		  $.ajax({ 
					   type : "post",
						url : "/SRRPBusinesWeb/investor/performanceEdit",
					   data : {"desc":JSON.stringify(desc),"manaData":JSON.stringify(manaData),"achieDatata":JSON.stringify(achieData)},
					success : function(data) {
						data = JSON.parse(data);
	                    var flag = update_successprocess(data);
	                    if (flag) {
	                    	        window.parent.document.getElementById("perFlag").value="1";
		     			        	window.parent.update_page("113");
		     			        	var index = parent.layer.getFrameIndex(window.name);
		     			        	parent.layer.close(index);
	                    }else{ 
	                    	  parent.layer.alert('提交失败', {
	                              title: '最终的提交信息'
	                          })
	                              return false;
	                          }
					     }
			       });
              }else{
            	  parent.layer.alert("机构信息正在审核，无法进行编辑。");
            	  return false;
              }
              return false;
        })
          function update_successprocess(data) {
	            if (data.code == "00000") {
	                return true;
	            } else {
	                return false;
	            }
 }
    }); 
    function reloadTable(data2) {
    	var table = layui.table;
    	document.getElementById("updateFlag").value="01";
    	document.getElementById("achieveUpdateFlag").value="01";
		    var oldData =  achievementTablelns.config.data; 
		    oldData.push(data2); 
		    achievementTablelns=table.reload('investorAchievementGrid',{  
		              data : oldData
		          }) 
		   }
    function reloadManageTable(data2) {
    	var table = layui.table;
    	document.getElementById("updateFlag").value="01";
    	document.getElementById("manageUpdateFlag").value="01";
		    var oldData =  manageAchievementTablelns.config.data; 
		    oldData.push(data2); 
		    manageAchievementTablelns=table.reload('investorManageAchievementGrid',{  
		              data : oldData
		          }) 
		   }
    function reloadTableList(data2) {
    	var form = layui.form,$=layui.jquery,layer=layui.layer;
    	var table = layui.table;
    	document.getElementById("achievementFalg").checked=true;
    	 form.render('radio');
    	 var aDedivV = document.getElementById("achievementDestDiv");
         var aTadivV = document.getElementById("achievementTableDiv");          
 if (aTadivV.style.display == "none") {
                 aTadivV.style.display = 'inline'; //展示审核意见
             }
             if (aDedivV.style.display == "inline") {
                 aDedivV.style.display = 'none'; //展示审核意见
             }     
    	  var oldData = achievementTablelns.config.data; 
    	data2.forEach(function(val,index){
    		 oldData.push(val); 
    	});
    	document.getElementById("updateFlag").value="01";
    	document.getElementById("achieveUpdateFlag").value="01";
         var manageAchievementFalg = $("input[name='manageAchievementFalg']:checked").val();
         achievementTablelns=table.reload('investorAchievementGrid',{  
		              data : oldData
		          }) 
		   }
    function reloadManageTableList(data2) {
    	var form = layui.form,$=layui.jquery,layer=layui.layer;
    	var table = layui.table;
    	document.getElementById("manageAchievementFalg").checked=true;
    	form.render('radio');
    	var DedivV = document.getElementById("manageAchievementDestDiv");
        var TadivV = document.getElementById("manageAchievementTableDiv");
if (TadivV.style.display == "none") {
                TadivV.style.display = 'inline'; //展示审核意见
            }
            if (DedivV.style.display == "inline") {
                DedivV.style.display = 'none'; //展示审核意见
            }
    	document.getElementById("updateFlag").value="01";
    	document.getElementById("manageUpdateFlag").value="01";
		    var oldData =  manageAchievementTablelns.config.data; 
		    data2.forEach(function(val,index){
	    		 oldData.push(val); 
	    	});
		    manageAchievementTablelns= table.reload('investorManageAchievementGrid',{  
		              data : oldData
		          }) 
		   }
    function returnManageTableList() {
    	var form = layui.form,$=layui.jquery,layer=layui.layer;
    	var table = layui.table;
    	 var oldData =  manageAchievementTablelns.config.data; 
    	 return oldData;
    }
    function returnAchieveTableList() {
    	var form = layui.form,$=layui.jquery,layer=layui.layer;
    	var table = layui.table;
    	var achieData = achievementTablelns.config.data; 
    	return achieData;
    }
</script>
</body>
</html>
