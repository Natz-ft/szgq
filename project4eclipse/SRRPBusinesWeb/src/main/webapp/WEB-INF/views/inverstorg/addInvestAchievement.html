<%@page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%> 
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta name="renderer" content="webkit|ie-comp|ie-stand"/> 
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>投资需求</title>
<script src="../static/script/autoload.js" type="text/javascript"></script>
<script src="../static/script/autoLoadStyle.js" type="text/javascript"></script>
<script src="../static/script/my97/WdatePicker.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../static/style/page/form.css">
<link rel="stylesheet" type="text/css" href="../static/style/page/todo.css">
<style>
.layui-form-label {
	padding: 6px 0px;
	width: 135px;
}

.input-insert-data {
	width: 184px;
	height: 22px;
	border: 1px solid #8DBDDC;
	border-radius: 3px;
}

.layui-form-select .layui-input {
	height: 22px;
	line-height: 22px;
	padding-right: 30px;
	cursor: pointer;
}

.layui-form-item {
	margin-bottom: -7px;
}

.layui-input-block1 {
	padding-top: 10px;
	padding-right: 20px;
	margin-left: 140px;
}

</style>
</head>
<body>
	<div class="boxWrap">
		<div class="boxContent">
			<div class="formWrap" >
				<form class="layui-form">
					<div style="margin-left: -16%;">
						<div class="form-left">
							<div class="layui-form-item">
								<label class="layui-form-label"><span class="star">*</span>投资基金名称：</label>
								<div class="layui-input-block">
									<input type="text" name="investmentFunds" id="investmentFunds" value=''
										autocomplete="off" class="form-input input-insert-data" 
										maxlength="50" style="margin-top: 4px;">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="margin-top: -4px;"><span class="star">*</span>已投资企业行业：</label>
<!-- 								<div class="input-insert-data" -->
<!-- 									style="margin-left: 135px; width: 184px;"> -->
<!-- 									<select name="investedEnterpriseIndustry" -->
<!-- 										id="investedEnterpriseIndustry"  -->
<!-- 										lay-search="" lay-filter="selectFilter"> -->
<!-- 										<option value="">直接选择或搜索选择</option> -->
<!-- 										<c:forEach items='${ddIndustry}' var="d"> -->
<!-- 											<option value='${d.dicCode}'>${d.dicName}</option> -->
<!-- 										</c:forEach> -->
<!-- 									</select> -->
<!-- 								</div> -->
                             <div class="layui-input-inline" style="border: 1px solid #8DBDDC;border-radius: 3px; width:20%;">
								 <select  lay-filter="industry"   name="industry1" id="industry">
									        <option value="">请选择一级行业</option>
									       <c:forEach items="${ddIndustry}" var="dind">
										      <c:if test="${dind.pId=='0'}">
											    <option value="${dind.id}">${dind.name}</option>
										      </c:if>
									       </c:forEach>
                                </select>
    					  </div>
					    <div class="layui-input-inline" style="width: 20%;border: 1px solid #8DBDDC;border-radius: 3px;">
										    <select id="industry2" name="industry2"> </select>
					    </div>
					 </div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="margin-top: -4px;"><span class="star">*</span>投资阶段：</label>
								<div class="input-insert-data"
									style="margin-left: 135px; width: 184px;">
									<select name="investmentStage" id="investmentStage"
										style="margin-top: 4px;" lay-search="">
										<option value="">直接选择或搜索选择</option>
										<c:forEach items='${ddfinanceStage}' var="d">
											<option value='${d.dicCode}'>${d.dicName}</option>
										</c:forEach>
									</select>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label"><span class="star">*</span>投资时间 ：</label>
								<div class="layui-input-block">
								          <input type="text" name="investmentTime" value='' id="investmentTime"
										   autocomplete="off" class="form-input input-insert-data"
										   style="margin-top: 4px;">
							    </div>
							</div>

						 <div class="layui-form-item">
								<label class="layui-form-label"><span class="star">*</span>股权比例：</label>
								<div class="layui-input-block">
									<input type="text" name="shareRatio"  
										autocomplete="off" class="form-input input-insert-data"
										maxlength="8" style="margin-top: 4px;"> %
								</div>
						 </div>
						 <!--  -->
						 <div class="layui-form-item" >
                          <label class="layui-form-label" style="margin-top: -2px;"><span class="star" style="margin-left:20px;">*</span>是否已退出：</label>
					      <div  class="layui-input-block" style="margin-left: 110px;">
					            <div  id="flagIdtest" class="layui-input-inline" style="margin-top: 2px; height: 22px;width: 100px;border: 1px solid #8DBDDC;border-radius: 3px">
                                <select id="signOut" name="signOut" lay-filter="business"   class="select"  >
                                    <option value='' >请选择</option>
                                    <option value="0" >是</option>
                                    <option value="1" >否</option>
                                </select>
					            </div>
                         </div>
                      </div>
						 <!--  -->
                        <div class="layui-form-item"  id="rateOfReturnId"  style="display: '';">
								<label class="layui-form-label"><span class="star">*</span>回报率：</label>
								<div class="layui-input-block">
									<input type="text" name="rateOfReturn" id='rateOfReturn'
										autocomplete="off" class="form-input input-insert-data"
										maxlength="8" style="margin-top: 4px;"> %
								</div>
					    </div>
						</div>
						<div class="form-right" style="float: left; width: 48%;">
							<div class="layui-form-item">
								<label class="layui-form-label"><span class="star">*</span>已投资企业名称：</label>
								<div class="layui-input-block">
									<input type="text" name="investedEnterprise" id="investedEnterprise" maxlength="50"
										autocomplete="off" class="form-input input-insert-data" 
										style="margin-top: 4px;">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="margin-top: -4px;"><span class="star">*</span>已投企业所属区域：</label>
								<div class="input-insert-data"
									style="margin-left: 135px; width: 184px;">
									<select name="investedEnterpriseArea" id="investedEnterpriseArea" 
										style="margin-top: 4px;" lay-search="">
										<option value="">直接选择或搜索选择</option>
										<optgroup label="苏州市内">
											<c:forEach items='${suzouddarea}' var="s">
													<option value='${s.dicCode}'>${s.dicName}</option>
											</c:forEach>
										</optgroup>
										<optgroup label="外地省市">
											<c:forEach items='${otherddarea}' var="o">
												<option value='${o.dicCode}'>${o.dicName}</option>
											</c:forEach>
										</optgroup>
									</select>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="margin-top: -4px;"><span class="star">*</span>投资轮次：</label>
								<div class="input-insert-data" style="margin-left: 135px; width: 184px;">
									<select name="roundOfInvestment" id="roundOfInvestment"
										style="margin-top: 4px;" lay-search="">
										<option value="">直接选择或搜索选择</option>
										<c:forEach items='${ddFinacingturn}' var="d">
											<option value='${d.dicCode}'>${d.dicName}</option>
										</c:forEach>
									</select>
								</div>
							</div>
							
							<!-- ----------------------------------------------------------------------------------------------------------- -->
							<div class="layui-form-item">
							  <label class="layui-form-label"><span class="star">*</span>投资金额：</label>
                              <div class="layui-input-block">
                               <div class="layui-input-inline" style="width: 200px;">
                                  <input type="text" maxlength="8" name="investmentAmount"  id="investmentAmount"  placeholder="请输入" autocomplete="off" class="form-input"
                                       value="<fmt:formatNumber value="" pattern="####.##"/>" style="width: 70px;height: 22px;float:left;margin-top: 5px; border: 1px solid #8DBDDC; border-radius: 3px;">
                                  <div class="layui-form-mid" style="left:6px;">万元</div>
                                  <div class="layui-input-inline formEleSpliceUnit form-select" style="height: 22px; width: 72px;margin-top: 5px; border: 1px solid #8DBDDC; border-radius: 3px;">
                                     <select name="iaCurrency" id="iaCurrency" >
                                         <option value='' >请选择币种</option>
                                         <c:forEach items='${ddCurrency}' var="d">
                                           <option value='${d.dicCode}' >${d.dicName}</option>
                                         </c:forEach>
                                      </select>
                                  </div>
                                </div>
                              </div>
                          </div>
						 <div class="layui-form-item">
							  <label class="layui-form-label"><span class="star">*</span>已投企业注册资本：</label>
                              <div class="layui-input-block">
                               <div class="layui-input-inline" style="width: 200px;">
                                  <input type="text" maxlength="8" name="enterpriseCapital"  id="enterpriseCapital"  placeholder="请输入" autocomplete="off" class="form-input"
                                       value="<fmt:formatNumber value="" pattern="####.##"/>" style="width: 70px;height: 22px;float:left;margin-top: 5px; border: 1px solid #8DBDDC; border-radius: 3px;">
                                  <div class="layui-form-mid" style="left:6px;">万元</div>
                                  <div class="layui-input-inline formEleSpliceUnit form-select" style="height: 22px; width: 72px;margin-top: 5px; border: 1px solid #8DBDDC; border-radius: 3px;">
                                     <select name="ecCurrency" id="ecCurrency" >
                                     <option value='' >请选择币种</option>
                                        <c:forEach items='${ddCurrency}' var="d">
                                           <option value='${d.dicCode}'>${d.dicName}</option>
                                       </c:forEach>
                                  </select>
                                  </div>
                                </div>
                              </div>
                          </div>
							<!-- ---------------------------------------------------------------------------------------------------------------------------- -->
                          <div class="layui-form-item" id="exitTimeId" style="visibility: none;">
							 <label class="layui-form-label"><span class="star">*</span>退出时间 ：</label>
							 <div class="layui-input-block">
								       <input type="text" name="exitTime" id="exitTime" value='' autocomplete="off"
										class="form-input input-insert-data"
										style="margin-top: 4px;">
							 </div>
						 </div>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-input-block buttonWrap"
							style="margin: 0 auto;">
							<button class="layui-btn submitBtn" lay-submit
								lay-filter="investorAchievementForm">&nbsp;&nbsp;保&nbsp;&nbsp;&nbsp;存&nbsp;&nbsp;</button>
							<button type="button" lay-close class="layui-btn closeBtn">&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script src="../static/script/autoLoadScript.js" type="text/javascript"></script>
	<script>
	$(function (){
		//调用日期控件
        var laydate = layui.laydate;
        laydate.render({
            elem: '#investmentTime' //指定元素
        });
        laydate.render({
            elem: '#exitTime' //指定元素
            ,max: 0   //当前时间为选择的最大时间
        });
        //调用富文本编辑器控件
        var layedit = layui.layedit;
        layedit.build('demandDetails'); //建立编辑器
		layui.use('form', function(){
		var form = layui.form;
         //显示隐藏退出时间,回报率		  
		var layer = layui.layer;
		form.on('select(business)', function(data){
			  var options = $("#signOut option:selected").val();
		        if (options == '1') {
		            document.getElementById("rateOfReturnId").style.display="none";
		            document.getElementById("exitTimeId").style.display="none";
		            $('#rateOfReturn').val('');
		            $('#exitTime').val('');
		        } else {
		        	document.getElementById("rateOfReturnId").style.display="";
		        	document.getElementById("exitTimeId").style.display="";
		        	
		        }
			})
		  //管理业绩表单提交	  
	      form.on('submit(investorAchievementForm)',function(data){ 
	    	  var  ManageTableList =window.parent.returnManageTableList();
	    	  var achieveTableList =window.parent.returnAchieveTableList();
	    	  var amountReg =/^\d+(\.\d{1,2})?$/;
	    	  if(data.field.investmentFunds===''||$.trim(data.field.investmentFunds)===''){
		    	    parent.layer.alert("请输入投资基金名称", {icon: 5});
		    	    $("#investmentFunds").focus();
	        		return false;
	           }
	    	  if(data.field.investedEnterprise===''||$.trim(data.field.investedEnterprise)===''){
         	      parent.layer.alert("请输入已投资企业名称", {icon: 5});
         	      $("#investedEnterprise").focus();
					  return false;
		    }
	    	  if(data.field.industry1===''){
		    	    parent.layer.alert("请选择已投资企业一极行业", {icon: 5});
		    	    $("#industry1").focus();
	        		return false;
	           }
	    	  if(data.field.investedEnterpriseArea===''){
         	      parent.layer.alert("请选择已投资企业所属区域", {icon: 5});
         	      $("#investedEnterpriseArea").focus();
					  return false;
		    }
	    	  if(data.field.investmentStage===''){
		    	    parent.layer.alert("请选择投资阶段", {icon: 5});
		    	    $("#investmentStage").focus();
	        		return false;
	           }
	    	  if(data.field.roundOfInvestment===''){
         	      parent.layer.alert("请选择投资轮次", {icon: 5});
         	      $("#roundOfInvestment").focus();
					  return false;
		    }
	           if(data.field.investmentTime===''){
		    	    parent.layer.alert("请输入投资时间", {icon: 5});
	        		return false;
	           }
	           if(data.field.investmentAmount===''){
	         	      parent.layer.alert("请输入投资金额", {icon: 5});
	         	      $("#investmentAmount").focus();
						  return false;
			    }
		        if(data.field.investmentAmount!=''){
		        	if(!(amountReg.test(data.field.investmentAmount))){
			        	parent.layer.alert("金额是最多两位小数的数字", {icon: 5});
		         	      $("#investmentAmount").focus();
							  return false;
			        }
		        }
		        if(data.field.iaCurrency===''){
	         	      parent.layer.alert("请投资金额币种", {icon: 5});
	         	      $("#iaCurrency").focus();
						  return false;
			    }
		        if(data.field.shareRatio===''){
		    	    parent.layer.alert("请输入股权比例", {icon: 5});
		    	    $("#shareRatio").focus();
	        		return false;
	           }
		       if(data.field.shareRatio!=''){
	            	   if(0 >data.field.shareRatio || data.field.shareRatio > 101){
		            		   parent.layer.alert("请正确输入股权比例", {icon: 5});
		            		   $("#shareRatio").focus();
		            		   return false;
	            	   }
	            } 
		        if(data.field.enterpriseCapital===''){
	         	      parent.layer.alert("请输入已投资企业注册资本", {icon: 5});
	         	      $("#enterpriseCapital").focus();
						  return false;
			    }
		        if(data.field.enterpriseCapital!=''){
		        	if(!(amountReg.test(data.field.enterpriseCapital))){
		        		parent.layer.alert("注册资本是最多两位小数的数字", {icon: 5});
		         	    $("#enterpriseCapital").focus();
						  return false;
		        	}
		        }
		        if(data.field.ecCurrency===''){
	         	      parent.layer.alert("请选择已投资企业注册资本币种", {icon: 5});
	         	      $("#ecCurrency").focus();
						  return false;
			    }
		        if(data.field.signOut==''){
		        	   parent.layer.alert("请选择是否已退出", {icon: 5});
		        		return false;
		        }
		        if(data.field.signOut=='0'){
		        	 if(data.field.exitTime==''){
			        	   parent.layer.alert("请输入退出时间", {icon: 5});
			        		return false;
			        }
		        	 if(data.field.investmentTime>data.field.exitTime){
		        		 parent.layer.alert("退出时间不能小于投资时间", {icon: 5});
			        		return false;
		        	 }
		        }else if(data.field.signOut=='1'){
		        	data.field.exitTime=="";
		        }
	           if(data.field.signOut=='0'){
	        	   if(data.field.rateOfReturn===''||$.trim(data.field.rateOfReturn)===''){
	          	      parent.layer.alert("请输入回报率", {icon: 5});
	          	      $("#rateOfReturn").focus();
	 					  return false;
	 		       }
	        	   if(data.field.rateOfReturn!=''){
			     	   if(0 >data.field.rateOfReturn ){
			         		   parent.layer.alert("请正确输入回报率", {icon: 5});
			         		   $("#rateOfReturn").focus();
			         		   return false;
			     	   }
			        } 
		        }else if(data.field.signOut=='1'){
		        	data.field.rateOfReturn==null;
		        }
	       		//表单提交校验
		       $.ajax({  
		                    type : "post",
		                    async : false,
		                    url : "/SRRPBusinesWeb/investor/investorAchievement",
		                    data : {"investorAchievementData" : JSON.stringify(data.field)},
		                    success : function(data) {
								data2= JSON.parse(data);  
						          window.parent.reloadTable(JSON.parse(data));
						          var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
						            parent.layer.close(index); //关闭layer(关闭当前窗口)
		                      }
	                });
	       });
		});
		//后端程序通过Jquery+Ajax将结果返回值提供给用户。
        function update_successprocess(data) {
            if (data.code == "00000") {
                return true;
            } else {
                return false;
            }
        }
		//取消按钮
        $(".closeBtn").on("click", function () {
       	    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index); //关闭layer(关闭当前窗口)
       })
    });
	
	 
	//相关二级联动的方法
	var zNodes='${ddIndustry}';
	function getIndustryChildren(parent){
		var childrenStr="";
		var childrenData=JSON.parse(zNodes);
		var industry2="${companyBaseSupplement.industry2}";
		for(var i=0;i<childrenData.length;i++){
	        if(childrenData[i].pId==parent){
	        	if(childrenData[i].id==industry2){
	            	childrenStr+='<option value="'+ childrenData[i].id +'" selected>' + childrenData[i].name + '</option>';

	        	}else{
	            	childrenStr+='<option value="'+ childrenData[i].id +'" >' + childrenData[i].name + '</option>';

	        	}
	        	 
	        }
	    }
	    return childrenStr;
	}
	layui.use(['form','jquery','layer'], function(){
	    var form = layui.form,$=layui.jquery,layer=layui.layer;
		form.on('select(industry)', function(data){
			   $("#industry2").html("");
			   var childrenDataStr="";
		       var options = $("#industry option:selected").val();
		       childrenDataStr='<option value="">请选择二级行业</option>';
		       childrenDataStr+=getIndustryChildren(options);
		       $("#industry2").append(childrenDataStr);
		       form.render('select');
		
		})
    })
	</script>
</body>
</html>
