<%@page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>发布投资需求</title>
    <script src="../static/script/autoload.js" type="text/javascript"></script>
    <script src="../static/script/autoLoadStyle.js" type="text/javascript"></script>
    <script src="../static/script/my97/WdatePicker.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../static/style/page/form.css">
</head>
<style>
    .optiondiv {
        width: 90px;
    }
    .form-input {
        width: 280px;
        height: 24px;
        border: 1px solid #8DBDDC;
        border-radius: 5px;
        margin-left: 6px;
        margin-top: 3px;
        padding-left: 5px;
    }

    .form-select {
        height: 24px;
        border: 1px solid #8DBDDC;
        border-radius: 4px;
        margin-left: 6px;
        margin-top: 6px;

    }
    .layui-form-select dl 
    {
         max-height:120px;
    }
    .layui-form-item{
    	height: 35px;
        margin-top: 6px;
    }
    .layui-form-select .layui-input {
         height: 24px;
     }
    
</style>
<body>
<!--头部logo以及登录注册开始-->
<div class="boxWrap">
    <p class="boxTitle"><span>编辑企业基本信息</span></p>
    <div class="boxContent">
        <div class="formWrap">
            <form class="layui-form" enctype="multipart/form-data">
                <div class="layui-form-item">
                    <label class="layui-form-label"><span class="star">*</span>企业名称：</label>
                    <div class="layui-input-block">
                        <input type="text" name="name" placeholder="请输入" class="form-input" value="${companyBasePending.name}" autocomplete="off"
                               class="layui-input" style="width:250px;">
                    </div>
                </div>
                <div class="form-left">
                    <div class="layui-form-item">
                        <label class="layui-form-label"><span class="star">*</span>证件类型：</label>
                        <div class="layui-input-block">
                        <c:forEach items="${ddCodeType}" var="codeType">
                            <input type="radio" lay-verify="required" name="codetype" value="${codeType.dicCode}" title="${codeType.dicName}"<c:if test ="${codeType.dicCode eq companyBasePending.codetype}">checked</c:if>>
                        </c:forEach>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label"><span class="star">*</span>注册资本：</label>
                        <div class="layui-input-block">
                            <input type="text" name="regcapital" maxlength ="8" placeholder="请输入" autocomplete="off" class="form-input"
                                       value="<fmt:formatNumber value="${companyBasePending.regcapital}" pattern="####.##"/>" style="width: 80px;float:left;">
                            <div class="layui-form-mid">百万</div>
                        </div>
                    </div>
                </div>
                <div class="form-right">
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 120px"><span class="star">*</span>证件号码：</label>
                        <div style="margin-left:120px;">
                            <input type="text" name="code" maxlength="18" placeholder="请输入" class="form-input"
                                   value="${companyBasePending.code}" style="width: 230px" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 120px"><span class="star">*</span>注册时间：</label>
                        <div class="layui-input-block">
                            <input type="text" name="redate" style="width: 230px" placeholder="请点击选择日期"
                                   value="${companyBasePending.redate}" autocomplete="off" class="form-input"
                                   id="redate">
                        </div>
                    </div>
                </div>
                 <div class="layui-form-item">
                        <label class="layui-form-label"><span class="star">*</span>所属区域：</label>
                        <div style="margin-left:116px; width: 120px; height: 24px;border: 1px solid #8DBDDC; border-radius: 3px;">
                            <select name="rearea" lay-filter="financeRound" style="height: 28px;">
                              <c:forEach items="${ddAreaType}" var="area">
                                    <option value="${area.dicCode}"
                                    <c:if test="${area.dicCode eq companyBasePending.rearea}">selected</c:if>
                                    >${area.dicName}</option>
                                </c:forEach>
                            </select>
                        </div>
                </div>
                <div class="layui-form-item">
                        <label class="layui-form-label"><span class="star">*</span>注册地址：</label>
                        <div class="layui-input-block">
                        <input type="text" name="registArea" placeholder="请输入" class="form-input" value="${companyBasePending.registArea}" autocomplete="off"
                               class="layui-input" style="width:500px;">
                        </div>
                </div>
                <div class="form-left" style="margin-left:-20px;">
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 120px"><span class="star">*</span>法定代表姓名：</label>
                        <div style="margin-left:120px;">
                            <input type="text" name="legalName" placeholder="请输入" class="form-input"
                                   value="${companyBasePending.legalName}" style="width: 230px;margin-left: 15px;" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 150px;margin-left: -30px;"><span class="star">*</span>融资事宜联系人姓名：</label>
                        <div style="margin-left:120px;">
                            <input type="text" name="contacName" placeholder="请输入" class="form-input"
                                   value="${companyBasePending.contacName}" style="width: 230px;margin-left: 15px;" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="form-right">
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 120px"><span class="star">*</span>法定代表手机号：</label>
                        <div style="margin-left:120px;">
                            <input type="text" name="legalCal" maxlength="11" placeholder="请输入" class="form-input"
                                   value="${companyBasePending.legalCal}" style="width: 230px" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label" style="width: 170px;margin-left: -50px;"><span class="star">*</span>融资事宜联系人手机号：</label>
                        <div style="margin-left:120px;">
                            <input type="text" name="contacCal" maxlength="11" placeholder="请输入" class="form-input"
                                   value="${companyBasePending.contacCal}" style="width: 230px" autocomplete="off"
                                   class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block buttonWrap">
                            <button class="layui-btn updateBtn" value="upload" lay-submit lay-filter="updateForm">&nbsp;&nbsp;确&nbsp;&nbsp;&nbsp;认&nbsp;&nbsp;</button>
                            <button type="button" lay-close class="layui-btn layui-btn-primary closeBtn">&nbsp;&nbsp;关&nbsp;&nbsp;&nbsp;闭&nbsp;&nbsp;</button>

                    </div>
                </div>
            </form>


        </div>
    </div>
</div>
<script src="../static/script/autoLoadScript.js" type="text/javascript"></script>
<script src="../portal/register/script/formValidatorRegex.js" type="text/javascript"></script>
<script>
    $(".closeBtn").on("click", function () {
        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
        parent.layer.close(index); //关闭layer(关闭当前窗口)
    });
    //修改需求的确认功能
    $(".updateBtn").on("click", function () {
        layui.use('form', function (companyBase) {
            var form = layui.form;
            //向机构投递需求
            form.on('submit(updateForm)', function (data) {
                if (!checkData(data)) {
                    return false;
                }
                $.ajax({
                    type: "post",
                    async: false,
                    url: "/SRRPBusinesWeb/enterprise/updateEnterprise",
                    data: {
                        "companyInfo": JSON.stringify(data.field),
                    },
                    success: function (data) {
                        layer.open({
                            title: '友好提示',
                            type: 1,
                            content: '<div style="padding: 10px 80px;">企业基本信息更新成功！</div>',
                            btn: '关闭',
                            btnAlign: 'c', //按钮居中
                            shade: 0,//不显示遮罩
                            yes: function () {
                                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
      					        parent.location.href="/SRRPBusinesWeb/enterprise/enterpriseDetail" ; //(刷新父级窗口) 
      				            parent.layer.close(index); //关闭layer(关闭当前窗口)
                            }
                        });
                    }
                });

                return false;
            });
        });
    });
    function checkData(data) {
    	if (data.field.name === '') {
            layer.msg("请输入企业名称");
            return false;
        }
        if (/^\d+\d+\d$/.test(data.field.name)) {
            layer.msg("企业名称不能全为数字");
            return false;
        }
        if (data.field.name.length > 50) {
            layer.msg("企业名称不能超过50个字符");
            return false;
        }
	        if (data.field.regcapital === '' || data.field.regcapital === '0') {
	            layer.msg("请输入注册资本");
	            return false;
	        }
// 	        if(data.field.codetype==='1'){
// 	        	if(data.field.codetype.length===10){
	        		if(!/[A-Za-z0-9]{8}-[A-Za-z0-9]/.test(data.field.code)){
	        			layer.msg("请输入正确的组织机构代码");
			            return false;
		            }
// 	        	}else{
// 	            	layer.msg("请输入正确的组织机构代码");
// 		            return false;
// 	            }
// 	        }else{
// 	        	if(!/[0-9A-HJ-NPQRTUWXY]{2}\d{6}[0-9A-HJ-NPQRTUWXY]{10}/.test(data.field.code)){
// 	        		layer.msg("请输入正确的统一信用代码");
// 		            return false;
// 	        	}
// 	        }
	        if (/[^\d.]/g.test(data.field.regcapital)) {
	            layer.msg("注册资本只能是数字");
	            return false;
	        }
	        if (data.field.regcapital.length > 12) {
	            layer.msg("融资金额不能超过12位");
	            return false;
	        }
	        if (data.field.redate === '') {
	            layer.msg("请选择有效关注时间");
	            return false;
	        }
	        if (data.field.legalName === '') {
	            layer.msg("请输入法定代表姓名");
	            return false;
	        }
	        if (data.field.legalName.length > 10) {
	            layer.msg("法定代表姓名不能超过10个字符");
	            return false;
	        }
	        if (data.field.legalCal === '') {
	            layer.msg("请输入法定代表电话");
	            return false;
	        }
	        if (!(/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(data.field.legalCal))) {
	            layer.msg("请正确输入法定代表手机号");
	            return false;
	        }
	        if (data.field.contacName === '') {
	            layer.msg("请输入联系人姓名");
	            return false;
	        }
	        if (data.field.contacName.length > 10) {
	            layer.msg("联系人姓名不能超过10个字符");
	            return false;
	        }
	        if (data.field.contacCal === '') {
	            layer.msg("请输入法定代表电话");
	            return false;
	        }
	        if (!(/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(data.field.contacCal))) {
	            layer.msg("请正确输入联系人手机号");
	            return false;
	        }
// 	        if(data.field.contacCal===data.field.legalCal){
// 	        	layer.msg("联系人手机号与法定代表手机号不能相同");
// 	            return false;
// 	        }
	        return true;
    }
</script>
<script type="text/javascript">
//调用日期控件
var laydate = layui.laydate;
laydate.render({
    elem: '#redate' //指定元素
   
});
</script>
</body>
</html>